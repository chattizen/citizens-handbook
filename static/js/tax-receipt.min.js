!function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),"function"==typeof define&&define.amd?define(c):a.Mustache=c}}(this,function(a){function b(a,b){return n.call(a,b)}function c(a){return!b(o,a)}function d(a){return"function"==typeof a}function e(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return r[a]})}function g(a){if(!q(a)||2!==a.length)throw new Error("Invalid tags: "+a);return[new RegExp(e(a[0])+"\\s*"),new RegExp("\\s*"+e(a[1]))]}function h(b,d){function f(){if(A&&!B)for(;z.length;)delete y[z.pop()];else z=[];A=!1,B=!1}d=d||a.tags,b=b||"","string"==typeof d&&(d=d.split(t));for(var h,l,m,n,o,p,q=g(d),r=new k(b),x=[],y=[],z=[],A=!1,B=!1;!r.eos();){if(h=r.pos,m=r.scanUntil(q[0]))for(var C=0,D=m.length;D>C;++C)n=m.charAt(C),c(n)?z.push(y.length):B=!0,y.push(["text",n,h,h+1]),h+=1,"\n"===n&&f();if(!r.scan(q[0]))break;if(A=!0,l=r.scan(w)||"name",r.scan(s),"="===l?(m=r.scanUntil(u),r.scan(u),r.scanUntil(q[1])):"{"===l?(m=r.scanUntil(new RegExp("\\s*"+e("}"+d[1]))),r.scan(v),r.scanUntil(q[1]),l="&"):m=r.scanUntil(q[1]),!r.scan(q[1]))throw new Error("Unclosed tag at "+r.pos);if(o=[l,m,h,r.pos],y.push(o),"#"===l||"^"===l)x.push(o);else if("/"===l){if(p=x.pop(),!p)throw new Error('Unopened section "'+m+'" at '+h);if(p[1]!==m)throw new Error('Unclosed section "'+p[1]+'" at '+h)}else"name"===l||"{"===l||"&"===l?B=!0:"="===l&&(q=g(d=m.split(t)))}if(p=x.pop())throw new Error('Unclosed section "'+p[1]+'" at '+r.pos);return j(i(y))}function i(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function j(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;h>g;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function k(a){this.string=a,this.tail=a,this.pos=0}function l(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function m(){this.cache={}}var n=RegExp.prototype.test,o=/\S/,p=Object.prototype.toString,q=Array.isArray||function(a){return"[object Array]"===p.call(a)},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},s=/\s*/,t=/\s+/,u=/\s*=/,v=/\s*\}/,w=/#|\^|\/|>|\{|&|=|!/;k.prototype.eos=function(){return""===this.tail},k.prototype.scan=function(a){var b=this.tail.match(a);if(b&&0===b.index){var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c}return""},k.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},l.prototype.push=function(a){return new l(a,this)},l.prototype.lookup=function(a){var b;if(a in this.cache)b=this.cache[a];else{for(var c=this;c;){if(a.indexOf(".")>0){b=c.view;for(var e=a.split("."),f=0;null!=b&&f<e.length;)b=b[e[f++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this.cache[a]=b}return d(b)&&(b=b.call(this.view)),b},m.prototype.clearCache=function(){this.cache={}},m.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=h(a,b)),d},m.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof l?b:new l(b);return this.renderTokens(d,e,c,a)},m.prototype.renderTokens=function(b,c,e,f){function g(a){return k.render(a,c,e)}for(var h,i,j="",k=this,l=0,m=b.length;m>l;++l)switch(h=b[l],h[0]){case"#":if(i=c.lookup(h[1]),!i)continue;if(q(i))for(var n=0,o=i.length;o>n;++n)j+=this.renderTokens(h[4],c.push(i[n]),e,f);else if("object"==typeof i||"string"==typeof i)j+=this.renderTokens(h[4],c.push(i),e,f);else if(d(i)){if("string"!=typeof f)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,f.slice(h[3],h[5]),g),null!=i&&(j+=i)}else j+=this.renderTokens(h[4],c,e,f);break;case"^":i=c.lookup(h[1]),(!i||q(i)&&0===i.length)&&(j+=this.renderTokens(h[4],c,e,f));break;case">":if(!e)continue;i=d(e)?e(h[1]):e[h[1]],null!=i&&(j+=this.renderTokens(this.parse(i),c,e,i));break;case"&":i=c.lookup(h[1]),null!=i&&(j+=i);break;case"name":i=c.lookup(h[1]),null!=i&&(j+=a.escape(i));break;case"text":j+=h[1]}return j},a.name="mustache.js",a.version="0.8.1",a.tags=["{{","}}"];var x=new m;a.clearCache=function(){return x.clearCache()},a.parse=function(a,b){return x.parse(a,b)},a.render=function(a,b,c){return x.render(a,b,c)},a.to_html=function(b,c,e,f){var g=a.render(b,c,e);return d(f)?void f(g):g},a.escape=f,a.Scanner=k,a.Context=l,a.Writer=m}),function(a,b,c,d,e){"use strict";function f(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function g(a){if(a=a.replace(/[\[]/,"[").replace(/[\]]/,"]"),!J[a]){var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);J[a]=null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}return J[a]}function h(){w.find("label").after(x),z.first().before(w),b.location.hash="";for(var c=B.municipalities.length-1;c>=0;c--)x.prepend('<option value="'+B.municipalities[c]+'">'+B.municipalities[c]+"</option>");r.find(":input[name]").each(function(){var b=a(this);!b.val()&&g(b.attr("name"))&&b.val(g(b.attr("name")))}),s.val()&&j(),g("city")&&(x.val(g("city")),y=g("city"),w.attr("data-available","true"),n(null,1)),g("property-value")&&o({target:C[0]}),g("city-taxes")&&o({target:E[0]}),g("county-taxes")&&o({target:G[0]})}function i(a){a.region&&a.region.abbr&&a.region.abbr===B.county.state?(x.val(a.locality),w.attr("data-available","true"),a.locality in B.cities?(t.addClass("has-success"),a.localities&&1===a.localities.length?w.find(".btn").click():w.find(".btn")[0].focus()):t.addClass("has-warning").append('<p class="alert alert-warning">We do not have tax data for your city. You can still see your county tax bill.</p>')):t.addClass("has-error").append('<p class="alert alert-danger">This tool only works in '+B.county.name+"&nbsp;County, "+B.county.state+".</p>")}function j(){u=s[0].value.substr(0,5),t.add(w).removeClass("has-error has-warning has-success").children(".alert").remove(),w.add(z).add(A).removeAttr("data-available"),q.empty(),v.test(u)?-1===a.inArray(u,B.validZips)?t.addClass("has-error").append('<p class="alert alert-danger">This tool only works in '+B.county.name+"&nbsp;County, "+B.county.state+".</p>"):g("city")?(w.attr("data-available","true"),x.val(g("city")),g("city")in B.cities?(t.addClass("has-success"),w.find(".btn")[0].focus()):t.addClass("has-warning").append('<p class="alert alert-warning">We do not have tax data for your city. You can still see your county tax bill.</p>')):a.ajax({url:"//s3.amazonaws.com/zips.dryan.io/"+u+".json",cache:!0,dataType:"json",success:i}):u.length>=5&&t.addClass("has-error").append('<p class="alert alert-danger">This does not appear to be a valid ZIP&nbsp;Code.</p>')}function k(a,b){return a.rate<b.rate?1:a.rate>b.rate?-1:0}function l(a){if(!D)return[];for(var b=a.length,c=0;b--;)c+=a[b].rate;for(a=a.sort(k),b=a.length;b--;){var d=a[b];d.old_percentage=d.percentage||0,d.amount=f((d.rate*D).toFixed(2)),d.percentage=d.rate/c*100,d.percentage_formatted=d.percentage.toFixed(2),d.index=b%6+1}return a}function m(c,d){c&&c.type&&"submit"===c.type&&(c.preventDefault(),c.stopPropagation(),b.location.hash="receipt"),D=.25*(parseFloat(C.val())||0),F=E.val(),H=G.val(),y&&(p.is(".calculated")||(d?p.addClass("calculated"):(p.addClass("animate"),setTimeout(function(){p.addClass("calculated")},1),setTimeout(function(){p.removeClass("animate")},700))),b.console.debug({city:{name:y,rate:(100*B.cities[y].rate).toFixed(2),items:l(B.cities[y].items||[])},county:{name:B.county.name,rate:(100*B.county.rate).toFixed(2),items:l(B.county.items||[])}}),q.html(e.render(I,{city:{name:y,rate:(100*B.cities[y].rate).toFixed(2),items:l(B.cities[y].items||[])},county:{name:B.county.name,rate:(100*B.county.rate).toFixed(2),items:l(B.county.items||[])}})),q.find("[data-percentage]").each(function(){var b=a(this);b.css("width",b.data("percentage"))}))}function n(a,b){a&&a.type&&"click"===a.type&&a.preventDefault(),y=x.val(),y in B.cities?z.attr("data-available","true"):z.filter(":not(:has(#id_city-taxes))").attr("data-available","true"),w.addClass("has-success"),C[0].focus(),m(null,b)}function o(c){try{var d=a(c.target),e=parseInt(d.val().replace(/[^\d]+/g,""),10);d.val(e);try{var f=c.target.selectionStart;c.target.selectionStart=f,c.target.selectionEnd=f}catch(g){}switch(c.type&&"keyup"===c.type&&d.data("manual-input",!0),d.attr("id")){case"id_property-value":D=e,!E.data("manual-input")&&y in B.cities&&(F=Math.round(e*B.cities[y].rate),E.val(F)),G.data("manual-input")||(H=Math.round(e*B.county.rate),G.val(H));break;case"id_city-taxes":F=e,!C.data("manual-input")&&y in B.cities&&(D=Math.round(e/(100*B.cities[y].rate)*100),C.val(D)),G.data("manual-input")||(H=Math.round(B.county.rate*(D?D:0)),G.val(H));break;case"id_county-taxes":H=e}}catch(h){b.console.error(h)}m()}var p=a("#main"),q=a("#receipt"),r=a("#calculator"),s=a("#id_zip"),t=s.closest(".field"),u=s.val(),v=/^[\d]{5}(-[\d]{4})?$/i,w=a('<li class="field" data-step="2"><p class="help-block">Please verify your city.</p><label for="id_city">City</label><a href="#" class="btn" tabindex="3">Next</a></li>'),x=a('<select name="city" id="id_city" tabindex="2"/>'),y=null,z=r.find('[data-step="3"]'),A=r.find('[data-step="4"]'),B={},C=a("#id_property-value"),D=C.val(),E=a("#id_city-taxes"),F=E.val(),G=a("#id_county-taxes"),H=G.val(),I=a("#template").text(),J={};a.getJSON("/api/tax-receipt-data.json").done(function(a){B=a,h()}).fail(function(){r.hide(),p.append("<p><strong>There was an error getting the tax data.</strong></p>")}),b.zipapicallback=i,s.on("keyup",j),s.val()&&j(),x.on("change",n),w.on("click",".btn",n),r.on("keyup","#id_property-value,#id_city-taxes,#id_county-taxes",o),r.on("submit",m),r.on("focus",".input-group :input",function(){a(this).closest(".input-group").addClass("focus")}),r.on("blur",".input-group :input",function(){a(this).closest(".input-group").removeClass("focus")})}(jQuery,window,document,window.console,window.Mustache);
//# sourceMappingURL=tax-receipt.min.map