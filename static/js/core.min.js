window.chattizen = window.chattizen || {};

var chattizen = window.chattizen;

!function(a, b) {
    "use strict";
    var c = a("html"), d = a("#show-nav"), e = a(".map"), f = a("#corejs");
    chattizen.apiKeys = {
        google: f.data("google-api-key"),
        sunlight: f.data("sunlight-api-key")
    }, d.on("click", function() {
        c.toggleClass("show-nav"), d.blur();
    }), b.load({
        test: e.length,
        yep: [ "/bower_components/leaflet/dist/leaflet.js", "/bower_components/leaflet/dist/leaflet.css" ],
        callback: {
            "leaflet.js": function() {
                for (var b = e.length; b--; ) {
                    var c = a(e[b]), d = window.L.map(e[b], {
                        center: [ 35.0456, -85.267 ],
                        zoom: 11,
                        zoomAnimation: !1,
                        fadeAnimation: !1
                    });
                    window.L.tileLayer("http://{s}.tiles.mapbox.com/v3/dryan.ib14dmok/{z}/{x}/{y}.png").addTo(d), 
                    a.getJSON("http://nominatim.openstreetmap.org/search?json_callback=?", {
                        street: c.data("street-address"),
                        city: c.data("locality"),
                        state: c.data("region"),
                        postalcode: c.data("postal-code"),
                        country: (c.data("country") || "US").toLowerCase(),
                        email: "daniel@openchattanooga.com",
                        format: "jsonv2"
                    }).done(function(b) {
                        a.isArray(b) && (b = b.shift()), window.console.debug(b), b.lat && b.lon ? (d.setView([ b.lat, b.lon ], 15), 
                        d.attributionControl.addAttribution(b.licence), window.L.marker([ b.lat, b.lon ], {
                            clickable: !1,
                            title: c.data("name") || ""
                        }).addTo(d)) : c.remove();
                    }).fail(function() {
                        c.remove();
                    });
                }
            }
        }
    });
}(window.jQuery, window.Modernizr);